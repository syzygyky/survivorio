<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>
  survivor.io Leveling Calculator
</title>
<style>
body {
  background-color: #222;
  color: #ddd;
}
input {
  background-color: #333;
  color: #ddd;
  border: solid 2px #aaa;
}
label {
  white-space: nowrap;
}
.flex-dl div{
  display: flex;
}
.flex-dl.star dt{
  width:84px;
}
.flex-dl.result dt{
  width:44px;
}
.flex-dl dd {
  font-weight: bold;
}
.bold {
  font-weight: bold;
}
</style>
</head>
<body>
  <div id="resorce-calc">
    <form name="form">
      <fieldset oninput="essenceCalc()">
        <legend>Possesions</legend>
        <p><label>Coin: <input type="number" name="coin" style="width:6em"></label>k</p>
        <p><label>Essence: <input type="number" name="essence" style="width:6em"></label>k</p>
      </fieldset>
      <fieldset oninput="essenceCalc()">
        <legend>Enhanced Survivor-Levels</legend>
        <p><label>N: <input type="text" name="nEnhance" class="textbox" placeholder="40,40,80"></label></p>
        <p><label>S: <input type="text" name="sEnhance" class="textbox" placeholder="40,40,80"></label></p>
      </fieldset>
      <fieldset oninput="essenceCalc()">
        <legend>Reset (or Current) Survivor-Levels</legend>
        <p><label>N: <input type="text" name="nReset" class="textbox" placeholder="40,40,80"></label></p>
        <p><label>S: <input type="text" name="sReset" class="textbox" placeholder="40,40,80"></label></p>
      </fieldset>
    </form>
    <div id="result">
      <dl class="flex-dl result"></dl>
    </div>
  </div>
  <hr>
  <div id="stats-calc">
    <form name="form2">
      <fieldset oninput="statsCalc()">
        <legend>Stats Calculator</legend>
        <p>
          <label>N<input type="radio" name="statsType" value="n" checked></label>
          <label>S<input type="radio" name="statsType" value="s"></label>
          <label>Lv: <input type="number" name="lv" style="width:4em"></label>
        </p>
        <p>
          <label>
            Upgrade:
          <select name="star">
            <option value="1">★</option>
            <option value="2">★★</option>
            <option value="3">★★★</option>
            <option value="4">★★★★</option>
            <option value="5">★★★★★</option>
            <option value="6">★★★★★★</option>            
          </select>
          <dl class="flex-dl star">
            <div><dt>★★</dt><dd>Atk +400, HP +2000</dd></div>
            <div><dt>★★★</dt><dd>HP +20%</dd></div>
            <div><dt>★★★★</dt><dd>Atk +1000, HP +5000</dd></div>
            <div><dt>★★★★★★</dt><dd>Atk +20%</dd></div>
          </dl>
        </p>
        <p>
          <label>Atk+<input type="number" name="atkUp" style="width:3em;">%, </label>
          <label>HP+<input type="number" name="hpUp" style="width:3em;">%, </label>
          <label>Clan Lv:
            <select name="perks">
              <option value="0">0+</option>
              <option value="4">2+</option>
              <option value="6">4+</option>
              <option value="8">6+</option>
              <option value="10">8+</option>
              <option value="12">10+</option>
              <option value="14">12+</option>
              <option value="16">14+</option>
              <option value="18">16+</option>
            </select>
          </label>
        </p>
      </fieldset>
    </form>
    <div id="result2">
      <dl class="flex-dl result"></dl>
      <p id="remark" style="font-size:80%"></p>
    </div>
  </div>
  <script>
    function essenceCalc(){
      const nResetInput = document.form.nReset.value.split(',');
      const sResetInput = document.form.sReset.value.split(',');
      const nEnhanceInput = document.form.nEnhance.value.split(',');
      const sEnhanceInput = document.form.sEnhance.value.split(',');
      const cntCoin = Number(document.form.coin.value);
      const cntEssence = Number(document.form.essence.value);
      const getLvs = function(array){
        const result = [];
        array.forEach(value=>{
          const num = Number(value);
          if(num > 0 && num < 121) result.push(num);
          if(num > 120) result.push(120);
        })
        return result;
      }
      const lvs = {
        nResets: getLvs(nResetInput),
        sResets: getLvs(sResetInput),
        nEnhances: getLvs(nEnhanceInput),
        sEnhances: getLvs(sEnhanceInput)
      }
      const totals = {};
      
      const resrcRequired = function(array){
        let result = {};
        result.coin = 0;
        result.essence = 0;
        
        for(let i=0; i < array.length; i++){
          result.coin += array[i].coin;
          result.essence += array[i].essence;
        }
        return result;
      }
      
      for(const key of Object.keys(lvs)){
        let array = [];
        let srvType;
        (key === 'nResets' || key === 'nEnhances') ? srvType = nSurvivor : srvType = sSurvivor;
        for(let i=0; i < lvs[key].length; i++){
          array.push(totalValues(srvType,lvs[key][i],false));
        }
        totals[key] = resrcRequired(array);
      }

      
      const coin = cntCoin + totals.nResets.coin + totals.sResets.coin - totals.nEnhances.coin - totals.sEnhances.coin;
      const essence = cntEssence*1000 + totals.nResets.essence + totals.sResets.essence - totals.nEnhances.essence - totals.sEnhances.essence;
      
      const resultHTML = `<div><dt>Coin:</dt><dd>${coin.toLocaleString()}k</dd></div><div><dt>Essence:</dt><dd>${essence.toLocaleString()}</dd></div>`;
      document.querySelector('#result dl').innerHTML = resultHTML;
     
    }
    function statsCalc(){
      const statsType = document.form2.statsType.value;
      let lv = Number(document.form2.lv.value);
      const star = Number(document.form2.star.value);
      const perks = Number(document.form2.perks.value);
      let atkUp = Number(document.form2.atkUp.value);
      let hpUp = Number(document.form2.hpUp.value);

      if(lv > 120) lv = 120;
      if(lv < 0) lv = 0;
      let srvType;
      (statsType === 's') ? srvType = sSurvivor : srvType = nSurvivor;
      const result = totalValues(srvType,lv,true);
      
      let atk = result.atk;
      let hp = result.hp;
      
      const lvBoost = {
        n:[1000,600,1000],
        s:[3000,1200,1800]
      }
      let remark = '';
      
      if(lv >= 20){
        hp += lvBoost[statsType][0];
        remark += `<label>Lv.20: <span class="bold">HP +${lvBoost[statsType][0]}</span></label>`;
      }
      if(lv >= 60) {
        atk += lvBoost[statsType][1];
        remark += `, <label>Lv.60: <span class="bold">Atk +${lvBoost[statsType][1]}</span></label>`;
      }
      if(lv >= 100) {
        atk += lvBoost[statsType][2];
        remark += `, <label>Lv.100: <span class="bold">Atk +${lvBoost[statsType][2]}</span></label>`;
      }
      if(star >= 2) {
        atk += 400;
        hp += 2000;
      }
      if(star >= 4) {
        atk += 1000;
        hp += 5000;
      }
      if(star >= 3) {
        hpUp += 20;     
      }
      if(star === 6) {
        atkUp += 20;
      }
        
      atk = Math.trunc(atk * (100 + perks + atkUp) / 100);
      hp = Math.trunc(hp * (100 + perks + hpUp) / 100);
      const resultHTML = `<div><dt>Atk: </dt><dd>${atk.toLocaleString()}</dd></div><div><dt>HP: </dt><dd>${hp.toLocaleString()}</dd></div><div><dt>Coin: </dt><dd>${result.coin.toLocaleString()}k</dd></div><div><dt>Essence: </dt><dd>${result.essence.toLocaleString()}</dd></div>`;
      document.querySelector('#result2 dl').innerHTML = resultHTML;
      let remarkHTML = '';
      (remark.length > 0) ? remarkHTML = `(${remark})` : remarkHTML = '';
      document.getElementById('remark').innerHTML = remarkHTML;
    }
    const nSurvivor = {
      coin: [0,0,10,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,69,72,75,78,81,84,87,90,95,100,105,110,115,120,125,130,135,140,145,151,157,163,169,175,182,189,196,203,210,216,222,228,234,240,245,250,255,260,265,270,275,280,285,290,294,298,302,306,310,313,316,319,322,325,327,329,331,333,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,357,358,359,360,361,362,363,364,365,366,367,368,369,370],
      essence: [0,0,100,100,100,100,150,150,150,160,170,180,190,200,210,220,240,260,280,300,320,340,360,380,400,420,440,460,480,500,520,540,560,580,600,620,640,660,680,700,720,740,760,780,800,820,840,860,880,900,920,940,960,980,1000,1200,1400,1600,1800,2000,2200,2400,2600,2800,3000,3200,3600,4000,4400,4800,5200,5600,6000,6400,6800,7200,7600,8000,8400,8800,9200,9600,10000,10400,10800,11200,11600,12000,12400,12800,13200,13600,14000,14400,15000,15600,16200,16800,17400,18000,19000,19500,20000,20500,21000,21500,22000,22500,23000,23500,24000,24500,25000,25500,26000,26500,27000,27500,28000,28500,29000],
      atk: [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,20,20,20,20,20,20,20,20,20,20,30,30,30,30,30,30,30,30,30,30,100,100,100,100,100,100,100,100,100,100,120,120,120,120,120,120,120,120,120,120,150,150,150,150,150,150,150,150,150,150,180,180,180,180,180,180,180,180,180,180,200,200,200,200,200,200,200,200,200,200,230,230,230,230,230,230,230,230,230,230,250,250,250,250,250,250,250,250,250,250],
      hp: [100,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,56,56,56,56,56,56,56,56,56,56,104,104,104,104,104,104,104,104,104,104,460,460,460,460,460,460,460,460,460,460,576,576,576,576,576,576,576,576,576,576,720,720,720,720,720,720,720,720,720,720,864,864,864,864,864,864,864,864,864,864,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960,960]
    }
    const sSurvivor = {
      coin: [0,0,10,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,69,72,75,80,86,92,98,104,110,116,122,128,134,140,146,152,158,164,170,176,182,188,194,201,208,215,222,229,236,243,250,257,264,272,280,288,296,304,312,320,328,336,344,353,362,371,380,389,398,407,416,425,434,444,454,464,474,484,494,504,514,524,534,544,554,564,574,584,594,604,614,624,634,644,654,664,674,684,694,704,714,724,734,744,754,764,774,784,794,804,814,824,834,844],
      essence: [0,0,100,100,100,100,150,150,150,160,170,180,190,200,210,220,240,260,280,300,320,340,360,380,400,420,440,460,480,500,520,540,560,580,600,620,640,660,680,700,750,800,850,900,950,1000,1200,1400,1600,1800,2000,2200,2400,2600,2800,3000,3200,3400,3600,3800,4000,4200,4400,4600,4800,5000,5500,6000,6500,7000,7500,8000,8500,9000,9500,10000,10500,11000,11500,12000,12500,13000,13500,14000,14500,15000,16000,17000,18000,19000,20000,21000,22000,23000,24000,25000,26000,27000,28000,29000,30000,31000,32000,33000,34000,35000,36000,37000,38000,39000,40000,41000,42000,43000,44000,45000,46000,47000,48000,49000,50000],
      atk: [10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,15,15,15,15,15,15,15,15,15,15,15,20,20,20,20,20,20,20,20,20,20,50,50,50,50,50,50,50,50,50,50,105,105,105,105,105,105,105,105,105,105,130,130,130,130,130,130,130,130,130,130,160,160,160,160,160,160,160,160,160,160,200,200,200,200,200,200,200,200,200,200,250,250,250,250,250,250,250,250,250,250,300,300,300,300,300,300,300,300,300,300,400,400,400,400,400,400,400,400,400,400],
      hp: [100,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,48,72,72,72,72,72,72,72,72,72,72,72,56,56,56,56,56,56,56,56,56,56,174,174,174,174,174,174,174,174,174,174,484,484,484,484,484,484,484,484,484,484,640,640,640,640,640,640,640,640,640,640,800,800,800,800,800,800,800,800,800,800,960,960,960,960,960,960,960,960,960,960,1200,1200,1200,1200,1200,1200,1200,1200,1200,1200,1400,1400,1400,1400,1400,1400,1400,1400,1400,1400,1600,1600,1600,1600,1600,1600,1600,1600,1600,1600],
    }
    const totalValues = function(srvType,lv,hasStats){
      const result = {};
      for(const key of Object.keys(srvType)){
        result[key] = 0;
      }
      for(let i=0; i < lv+1; i++){
        if(hasStats){
          result.atk += srvType.atk[i];
          result.hp += srvType.hp[i];
        }
        result.coin += srvType.coin[i];
        result.essence += srvType.essence[i];
      }
      return result;
    }
  </script>
</body>
</html>
